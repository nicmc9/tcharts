(function(t){function i(i){for(var r,o,a=i[0],h=i[1],c=i[2],d=0,u=[];d<a.length;d++)o=a[d],n[o]&&u.push(n[o][0]),n[o]=0;for(r in h)Object.prototype.hasOwnProperty.call(h,r)&&(t[r]=h[r]);l&&l(i);while(u.length)u.shift()();return s.push.apply(s,c||[]),e()}function e(){for(var t,i=0;i<s.length;i++){for(var e=s[i],r=!0,a=1;a<e.length;a++){var h=e[a];0!==n[h]&&(r=!1)}r&&(s.splice(i--,1),t=o(o.s=e[0]))}return t}var r={},n={app:0},s=[];function o(i){if(r[i])return r[i].exports;var e=r[i]={i:i,l:!1,exports:{}};return t[i].call(e.exports,e,e.exports,o),e.l=!0,e.exports}o.m=t,o.c=r,o.d=function(t,i,e){o.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:e})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,i){if(1&i&&(t=o(t)),8&i)return t;if(4&i&&"object"===typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(o.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var r in t)o.d(e,r,function(i){return t[i]}.bind(null,r));return e},o.n=function(t){var i=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(i,"a",i),i},o.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},o.p="/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],h=a.push.bind(a);a.push=i,a=a.slice();for(var c=0;c<a.length;c++)i(a[c]);var l=h;s.push([0,"chunk-vendors"]),e()})({0:function(t,i,e){t.exports=e("56d7")},"2a9e":function(t,i,e){},"56d7":function(t,i,e){"use strict";e.r(i);e("cadf"),e("551c"),e("f751"),e("097d");var r=e("2b0e"),n=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{attrs:{id:"app"}},[e("div",{staticClass:"night-mode"},[t.isNight?e("p",{on:{click:function(i){t.isNight=!t.isNight}}},[t._v("Switch to Day Mode ")]):e("p",{on:{click:function(i){t.isNight=!t.isNight}}},[t._v("Switch to Night Mode ")])]),e("ul",{staticClass:"select-chart"},t._l(t.charts,function(i,r){return e("li",{key:r},[e("p",{staticClass:"number"},[t._v("Chart№"+t._s(r+1))]),e("chart-canvas",{attrs:{chart:i,isNight:t.isNight,hWindow:t.hWindow,wWindow:t.wWindow}})],1)}),0)])},s=[],o=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",[e("div",{staticClass:"stage",style:{width:t.prevWidth+"px",height:t.mainCanvasHeight+"px"}},[e("canvas",{ref:"board",attrs:{width:t.prevWidth,height:t.mainCanvasHeight},on:{mouseenter:t.mainEnter,mousemove:t.mainMove,mouseleave:t.mainUp}}),e("canvas",{ref:"main",attrs:{width:t.prevWidth,height:t.mainCanvasHeight}})]),e("canvas",{ref:"preview",attrs:{width:t.prevWidth,height:t.prevCanvasHeight},on:{mousedown:t.previewDown,mousemove:t.previewMove,mouseup:t.previewUp,mouseleave:t.previewUp}}),e("br"),e("ul",{staticClass:"checkbox"},t._l(t.names,function(i,r){return e("li",{staticClass:"checkbox__li"},[e("label",[e("input",{staticClass:"checkbox__input",attrs:{type:"checkbox"},domProps:{value:r},on:{change:function(i){return t.updateGraph(r)}}}),e("span",{staticClass:"checkbox__button",style:{"border-color":t.colors[r]}}),e("i",{staticClass:"checkbox__i"},[t._v("✔")]),e("span",{staticClass:"checkbox__text",style:t.isNight?{color:"white","border-color":"#40566b"}:""},[t._v(t._s(i))])]),e("br")])}),0),e("br"),e("a",{staticClass:"save",attrs:{href:t.file,download:"chart"},on:{click:t.save}},[t._v("Save chart")])])},a=[],h=e("a4bb"),c=e.n(h),l=(e("6c7b"),e("55dd"),{props:["chart","isNight","hWindow","wWindow"],data:function(){return{ctxPreview:0,ctxMain:0,ctxBoard:0,colors:{},names:{},types:{},columns:{},previewCoord:[],maxValue:1,countLine:5,boxXcoord:0,boxWidth:280,activGraph:[],xOffset:0,selectedBox:!1,selectedLeftSide:!1,selectedRightSide:!1,timeId:0,mouseX:0,mainData:[],currentData:[],step:0,ratioMain:1,timeColor:this.$options.dayColor,datesArr:[],file:""}},dayColor:{fillPreview:"rgba(245,249,251,0.5)",box:"rgba(221,234,243,0.5)",metrics:"rgba(139,147,153)",gLine:"rgba(221,234,243,0.5)",textInfo:"#000",board:"#fff"},nightColor:{fillPreview:"rgba(31,42,56,0.5)",box:"rgba(95,128,158,0.5)",metrics:"rgba(95,128,158)",gLine:"rgba(64,86,107,0.5)",textInfo:"#fff",board:"#2b384a"},watch:{isNight:function(){this.isNight?(this.timeColor=this.$options.nightColor,document.body.style.backgroundColor="#293647"):(document.body.style.backgroundColor="white",this.timeColor=this.$options.dayColor),this.activGraph.length?this.draw():this.defaultDraw()}},computed:{prevWidth:function(){var t=Math.round(.8*this.wWindow);return t<600&&(t=600),t},mainHeight:function(){var t=Math.round(.6*this.hWindow);return t<400&&(t=400),t},prevHeight:function(){return Math.round(.15*this.mainHeight)},prevShift:function(){return this.prevHeight/10},mainShift:function(){return this.mainHeight/10},mainCanvasHeight:function(){return this.mainHeight+this.mainShift},prevCanvasHeight:function(){return this.prevHeight+this.prevShift},boxStop:function(){return.2*this.prevWidth},xStep:function(){return this.prevWidth/(this.columns[0].length-1)},start:function(){return this.boxXcoord/this.xStep+1},end:function(){return this.start+this.boxWidth/this.xStep},metricValue:function(){var t=this.maxValue/this.countLine-1;return Math.ceil(t)},shiftY:function(){return this.mainHeight/this.countLine}},updated:function(){this.init(),console.log("Ну обновился я")},methods:{save:function(){var t=this.$refs.main;this.file=t.toDataURL("image/png")},updateGraph:function(t){console.log("key",t);var i=this.activGraph.indexOf(t);-1===i?(this.activGraph.push(t),this.activGraph.sort()):this.activGraph.splice(i,1),this.activGraph.length?(this.setPreviewCoord(),this.draw()):this.defaultDraw()},isIntoSlider:function(t){return t>this.boxXcoord&&t<this.boxXcoord+this.boxWidth},isIntoLeftSide:function(t){return t>=this.boxXcoord&&t<=this.boxXcoord+15},isIntoRightSide:function(t){return t>=this.boxXcoord+this.boxWidth-15&&t<=this.boxXcoord+this.boxWidth},previewDown:function(t){if(this.activGraph.length){var i=this,e=t.pageX-this.xOffset;this.isIntoLeftSide(e)?(this.selectedLeftSide=!0,i.timeId=setInterval(function(){i.draw()},50)):this.isIntoRightSide(e)?(this.selectedRightSide=!0,i.timeId=setInterval(function(){i.draw()},50)):this.isIntoSlider(e)&&(this.selectedBox=!0,i.timeId=setInterval(function(){i.draw()},50))}},previewUp:function(){this.activGraph.length&&(this.selectedBox=!1,this.selectedLeftSide=!1,this.selectedRightSide=!1,clearInterval(this.timeId))},previewMove:function(t){if(this.activGraph.length)if(this.selectedLeftSide){var i=t.pageX-this.xOffset,e=this.boxXcoord;this.boxXcoord=i;var r=this.boxWidth;r+=e-this.boxXcoord,r<=this.boxStop?this.boxXcoord=e:this.boxWidth=r}else if(this.selectedRightSide){var n=t.pageX-this.xOffset,s=this.boxXcoord+this.boxWidth,o=n-s,a=this.boxWidth+o;if(a<=this.boxStop)return;if(this.boxXcoord+a>=this.prevWidth)return;this.boxWidth=a}else if(this.selectedBox){var h=t.pageX-this.xOffset;this.boxXcoord=h-this.boxWidth/2,this.boxXcoord<0?this.boxXcoord=0:this.boxXcoord>=this.prevWidth-this.boxWidth&&(this.boxXcoord=this.prevWidth-this.boxWidth)}},mainEnter:function(){console.log("я вошел"),this.activGraph.length&&(this.timeId=requestAnimationFrame(this.drawInfoBoard))},mainUp:function(t){console.log("я вышел"),this.activGraph.length&&(cancelAnimationFrame(this.timeId),this.ctxBoard.clearRect(0,-this.mainHeight-50,this.prevWidth,this.mainHeight+100))},mainMove:function(t){if(this.activGraph.length)for(var i=this,e=t.pageX-i.xOffset,r=0,n=0;r<i.prevWidth;r+=i.step,n++){var s=r-i.step,o=r-this.step/2;if(e<r&&e>=o){a(n,r);break}if(e<o&&e>=s){a(n-1,s);break}}function a(t,e){i.mouseX=e;var r={month:"short",day:"numeric",weekday:"short"},n=new Date(i.mainData[0][t]).toLocaleString("en-US",r);i.currentData=[],i.currentData.push(n);for(var s=1;s<i.mainData.length;s++)i.currentData.push(i.mainData[s][t])}},drawInfoBoard:function(){var t=this.ctxBoard,i=this;t.clearRect(0,-this.mainHeight-50,this.prevWidth,this.mainHeight+100),t.fillStyle=this.timeColor.board,t.font="bold 25px sans-serif",t.save(),t.strokeStyle=this.timeColor.box,g(),t.shadowBlur=2,t.shadowColor="rgba(0, 0, 0, 0.3)";var e=this.prevWidth/7,r=this.mainHeight/6,n=20,s=r/3.5,o="",a=[];d(),u();var h=i.mouseX-e/2;function c(i,e,r,n,s){t.beginPath(),t.moveTo(i+s,e),t.lineTo(i+r-s,e),t.quadraticCurveTo(i+r,e,i+r,e+s),t.lineTo(i+r,e+n-s),t.quadraticCurveTo(i+r,e+n,i+r-s,e+n),t.lineTo(i+s,e+n),t.quadraticCurveTo(i,e+n,i,e+n-s),t.lineTo(i,e+s),t.quadraticCurveTo(i,e,i+s,e),t.closePath(),t.fill()}function l(){for(var e=1;e<i.currentData.length;e++){t.strokeStyle=i.colors[i.activGraph[e-1]];var r=-i.currentData[e]/i.ratioMain;t.beginPath(),t.arc(i.mouseX,r,5,0,2*Math.PI,!0),t.fill(),t.beginPath(),t.arc(i.mouseX,r,5,0,2*Math.PI,!0),t.stroke()}}function d(){for(var e=1;e<i.currentData.length;e++){var r=t.measureText(i.currentData[e]);a.push(r.width)}}function u(){for(var t=n,i=0;i<a.length;i++)t+=a[i]+n;t>e&&(e=t)}function f(){t.fillText(i.currentData[0],h+n,-i.mainHeight+s)}function v(){for(var e=0,r=1,o=n;r<i.currentData.length;r++,o+=n)t.fillStyle=i.colors[i.activGraph[r-1]],1===r?t.fillText(i.currentData[r],h+o,-i.mainHeight+2*s):(e+=a[r-2],t.fillText(i.currentData[r],h+o+e,-i.mainHeight+2*s))}function p(){for(var e=0,r=1,c=n;r<i.currentData.length;r++,c+=n)t.fillStyle=i.colors[i.activGraph[r-1]],o=i.names[i.activGraph[r-1]],1===r?t.fillText(o,h+c,-i.mainHeight+3*s):(e+=a[r-2],t.fillText(o,h+c+e,-i.mainHeight+3*s))}function g(){t.beginPath(),t.moveTo(i.mouseX,0),t.lineTo(i.mouseX,-i.mainHeight),t.stroke()}h<=0?h=2:h+e>i.prevWidth&&(h=i.prevWidth-e-2),l(),c(h,-i.mainHeight,e,r,10),t.restore(),t.lineWidth=2,v(),t.fillStyle=i.timeColor.textInfo,t.font="20px sans-serif",f(),t.font=" 16px sans-serif",p(),this.timeId=requestAnimationFrame(this.drawInfoBoard)},getCoords:function(t){var i=t.getBoundingClientRect();return{top:i.top+pageYOffset,left:i.left+pageXOffset}},setCurrentMainData:function(){var t=[];this.mainData=[];var i=this.columns[0];t=i.slice(this.start,this.end),this.mainData.push(t);for(var e=1;e<this.columns.length;e++)i=this.columns[e],-1!==this.activGraph.indexOf(i[0])&&(t=i.slice(this.start,this.end),this.mainData.push(t));this.step=this.prevWidth/t.length},getPreviewRatio:function(){for(var t=[],i=1;i<this.columns.length;i++){var e=this.columns[i];if(-1!==this.activGraph.indexOf(e[0])){var r=e[0];e[0]=0,t.push(Math.max.apply(null,e)),e[0]=r}}var n=Math.max.apply(null,t),s=n/this.prevHeight;return s=Math.round(100*s)/100,s},setMainRatio:function(){for(var t=[],i=1;i<this.mainData.length;i++){var e=this.mainData[i];t.push(Math.max.apply(null,e))}this.maxValue=Math.max.apply(null,t),this.ratioMain=this.maxValue/this.mainHeight,this.ratioMain=Math.round(100*this.ratioMain)/100},drawGraph:function(t,i,e,r){var n=0;i.strokeStyle=e,i.beginPath(),i.moveTo(n,t[0]);for(var s=1;s<t.length;s++)n+=r,i.lineTo(n,t[s]);i.stroke()},drawBox:function(t){t.strokeStyle=this.timeColor.box;var i=this.boxXcoord+this.boxWidth,e=this.prevShift/2,r=15,n=r/2;t.lineWidth=r,t.beginPath(),t.moveTo(this.boxXcoord+n,-this.prevHeight-e),t.lineTo(this.boxXcoord+n,e),t.moveTo(i-n,-this.prevHeight-e),t.lineTo(i-n,e),t.stroke(),t.lineWidth=4,t.beginPath(),t.moveTo(this.boxXcoord,-this.prevHeight-e),t.lineTo(i,-this.prevHeight-e),t.moveTo(i,e),t.lineTo(this.boxXcoord,e),t.stroke()},drawFillBox:function(t){var i=this.prevShift/2;t.fillStyle=this.timeColor.fillPreview;var e=this.boxXcoord+this.boxWidth;t.fillRect(0,-this.prevHeight-i,this.boxXcoord,this.prevCanvasHeight),t.fillRect(e,-this.prevHeight-i,this.prevWidth-e,this.prevCanvasHeight)},drawMetrics:function(t){t.fillStyle=this.timeColor.metrics,t.strokeStyle=this.timeColor.gLine,t.font="16px sans-serif",this.drawDate(t),this.drawYmeter(t)},setDateArray:function(){var t={month:"short",day:"numeric"},i=this.columns[0];this.datesArr=[];for(var e=0;e<i.length;e++)e%6===0?this.datesArr.push(new Date(i[e]).toLocaleString("en-US",t)):this.datesArr.push("");this.datesArr[1]=new Date(i[1]).toLocaleString("en-US",t),this.datesArr[this.datesArr.length-1]=new Date(i[i.length-1]).toLocaleString("en-US",t)},drawDate:function(t){var i=this.datesArr.slice(this.start,this.end),e=this.step,r=[];console.log("e",this.e),console.log("date",i);for(var n=0;n<i.length;n++)i[n]&&r.push(i[n]);function s(){for(var t=r.length;t>=0;t-=2)r.splice(t,1);r.length>6&&s()}function o(){t.beginPath();for(var n=0,s=0;s<i.length;s++)i[s]&&-1!==r.indexOf(i[s])&&t.fillText(i[s],n-20,20),n+=e;t.stroke()}r.length>6?(s(),o()):o()},drawYmeter:function(t){t.fillText("0",5,-5),t.beginPath();for(var i=0;i<this.countLine+1;i++)t.moveTo(0,-this.shiftY*i),t.lineTo(this.prevWidth,-this.shiftY*i),t.fillText(this.metricValue*i,5,-this.shiftY*i-5);t.stroke()},setPreviewCoord:function(){var t=this.getPreviewRatio();this.previewCoord=[];for(var i=[],e=1;e<this.columns.length;e++){var r=this.columns[e];if(-1!==this.activGraph.indexOf(r[0])){for(var n=1;n<r.length;n++)i.push(-r[n]/t);this.previewCoord.push(i),i=[]}}},drawPreviewGraphs:function(t){for(var i=0;i<this.previewCoord.length;i++){var e=this.previewCoord[i],r=this.colors[this.activGraph[i]];this.drawGraph(e,t,r,this.xStep)}},drawMainGraphs:function(t){for(var i=[],e=1;e<this.mainData.length;e++){for(var r=this.mainData[e],n=0;n<r.length;n++)i.push(-r[n]/this.ratioMain);var s=this.colors[this.activGraph[e-1]];this.drawGraph(i,t,s,this.step),i=[]}},draw:function(){var t=this.ctxMain,i=this.ctxPreview;i.clearRect(0,-this.prevHeight-this.prevShift/2,this.prevWidth,this.prevCanvasHeight),t.clearRect(0,-this.mainHeight-this.mainShift/2,this.prevWidth,this.mainCanvasHeight),this.setCurrentMainData(),this.setMainRatio(),this.drawMetrics(t),this.drawBox(i),i.lineWidth=2,this.drawPreviewGraphs(i),this.drawMainGraphs(t),this.drawFillBox(i)},defaultDraw:function(){var t=this.ctxMain,i=this.ctxPreview;i.clearRect(0,-this.prevHeight-this.prevShift/2,this.prevWidth,this.prevCanvasHeight),t.clearRect(0,-this.mainHeight-this.mainShift/2,this.prevWidth,this.mainCanvasHeight),i.fillStyle=this.timeColor.gLine,t.fillStyle=this.timeColor.gLine,i.fillRect(0,-this.prevHeight-this.prevShift/2,this.prevWidth,this.prevCanvasHeight),t.fillRect(0,-this.mainHeight-this.mainShift/2,this.prevWidth,this.mainCanvasHeight),t.strokeStyle="#000",t.fillText("0",5,-5),t.beginPath();for(var e=0;e<this.countLine+1;e++)t.moveTo(0,-this.shiftY*e),t.lineTo(this.prevWidth,-this.shiftY*e);t.stroke()},init:function(){var t=this.$refs.preview;this.ctxPreview=t.getContext("2d");var i=this.$refs.main;this.ctxMain=i.getContext("2d");var e=this.$refs.board;this.ctxBoard=e.getContext("2d"),this.colors=this.chart.colors,this.names=this.chart.names,this.types=this.chart.types,this.columns=this.chart.columns,this.ctxPreview.restore(),this.ctxMain.restore(),this.ctxBoard.restore(),this.ctxPreview.save(),this.ctxMain.save(),this.ctxBoard.save();var r=this.mainHeight+this.mainShift/2,n=this.prevHeight+this.prevShift/2;console.log("this.mainHeight",this.mainHeight),console.log("this.prevHeight",this.prevHeight),console.log("this.mainCanvasHeight",this.mainCanvasHeight),console.log("this.prevCanvasHeight",this.prevCanvasHeight),console.log("chiftM",r),console.log("chiftP",n),this.ctxPreview.translate(0,n),this.ctxMain.translate(0,r),this.ctxBoard.translate(0,r),this.activGraph=c()(this.colors);var s=this.getCoords(t);this.xOffset=s.left,this.ctxMain.lineWidth=2,this.ctxPreview.lineWidth=2,this.boxXcoord=0,this.boxWidth=280,this.setDateArray(),this.setPreviewCoord(),this.draw()}},created:function(){console.log("mounted")},mounted:function(){this.init(),console.log("mounted")},name:"ChartCanvas"}),d=l,u=(e("dd8e"),e("2877")),f=Object(u["a"])(d,o,a,!1,null,"188ad938",null),v=f.exports,p={data:function(){return{charts:[],isNight:!1,hWindow:null,wWindow:null}},methods:{onResize:function(){this.hWindow=document.documentElement.clientHeight,this.wWindow=document.documentElement.clientWidth}},created:function(){this.hWindow=document.documentElement.clientHeight,this.wWindow=document.documentElement.clientWidth},mounted:function(){var t=this;function i(t){var i=new XMLHttpRequest;i.overrideMimeType("application/json"),i.open("GET","chart_data.json",!0),i.onreadystatechange=function(){4==i.readyState&&"200"==i.status&&t(i.responseText)},i.send(null)}window.addEventListener("resize",this.onResize),i(function(i){t.charts=JSON.parse(i)})},beforeDestroy:function(){window.removeEventListener("resize",this.onResize)},name:"app",components:{ChartCanvas:v}},g=p,m=(e("eb0f"),Object(u["a"])(g,n,s,!1,null,"9a054fec",null)),x=m.exports;r["a"].config.productionTip=!1,new r["a"]({render:function(t){return t(x)}}).$mount("#app")},aa1e:function(t,i,e){},dd8e:function(t,i,e){"use strict";var r=e("2a9e"),n=e.n(r);n.a},eb0f:function(t,i,e){"use strict";var r=e("aa1e"),n=e.n(r);n.a}});
//# sourceMappingURL=app.2a90b5ec.js.map